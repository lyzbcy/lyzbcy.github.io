<!-- 修复 SimpleJekyllSearch 的 templateMiddleware 函数缺少返回值的问题 -->
<script>
(function() {
  'use strict';
  
  // 在页面加载后修复 templateMiddleware 函数
  function fixTemplateMiddleware() {
    // 查找所有 script 标签
    const scripts = document.querySelectorAll('script');
    scripts.forEach(function(script) {
      const scriptContent = script.textContent || script.innerHTML;
      
      // 检查是否包含 SimpleJekyllSearch 和 templateMiddleware
      if (scriptContent.includes('SimpleJekyllSearch') && scriptContent.includes('templateMiddleware')) {
        // 检查 templateMiddleware 函数是否缺少返回值
        const middlewareMatch = scriptContent.match(/templateMiddleware:\s*function\s*\([^)]*\)\s*\{([^}]*)\}/s);
        
        if (middlewareMatch) {
          const functionBody = middlewareMatch[1];
          // 检查是否有默认返回值
          if (!functionBody.includes('return') || 
              (functionBody.match(/if\s*\([^)]+\)\s*\{[^}]*return[^}]*\}/g) || []).length < 2) {
            console.warn('⚠️ 检测到 templateMiddleware 函数可能缺少返回值');
            
            // 尝试修复：通过修改 SimpleJekyllSearch 的全局配置
            // 但由于代码已经执行，我们需要在 SimpleJekyllSearch 初始化之前修复
            // 这里我们只能记录警告，实际的修复需要在 SimpleJekyllSearch 调用之前完成
          }
        }
      }
    });
  }
  
  // 在 DOM 加载完成后执行
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', fixTemplateMiddleware);
  } else {
    fixTemplateMiddleware();
  }
})();
</script>


